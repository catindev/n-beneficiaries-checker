{
  "comment": "Форматные проверки для ФЛ-резидент. Паспорт РФ (код 21) — всегда.",
  "rules": [
    {
      "name": "inn_present",
      "conditions": {
        "all": [
          {
            "fact": "inn",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "inn",
          "code": "INN_MISSING",
          "message": "ИНН обязателен",
          "ruleId": "inn_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "inn_length",
      "conditions": {
        "all": [
          {
            "fact": "inn",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "inn",
            "operator": "matchesRegex",
            "value": "^\\d{12}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "inn",
          "code": "INN_INVALID_LENGTH",
          "message": "ИНН физического лица должен содержать ровно 12 цифр",
          "ruleId": "inn_length",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "inn_not_all_same_digits",
      "conditions": {
        "all": [
          {
            "fact": "inn",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "inn",
            "operator": "allSameDigits",
            "value": true
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "inn",
          "code": "INN_ALL_SAME_DIGITS",
          "message": "ИНН не может состоять из одинаковых цифр",
          "ruleId": "inn_not_all_same_digits",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "inn_checksum",
      "conditions": {
        "all": [
          {
            "fact": "inn",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "inn",
            "operator": "validInnChecksum",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "inn",
          "code": "INN_INVALID_CHECKSUM",
          "message": "Неверный контрольный разряд ИНН",
          "ruleId": "inn_checksum",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "last_name_present",
      "conditions": {
        "all": [
          {
            "fact": "last_name",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "last_name",
          "code": "LAST_NAME_MISSING",
          "message": "Фамилия обязательна",
          "ruleId": "last_name_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "last_name_format",
      "conditions": {
        "all": [
          {
            "fact": "last_name",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "last_name",
            "operator": "matchesRegex",
            "value": "^[а-яеА-Яе\\-]{1,100}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "last_name",
          "code": "LAST_NAME_INVALID",
          "message": "Фамилия не должна содержать цифры или спецсимволы кроме дефиса, максимум 100 символов",
          "ruleId": "last_name_format",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "first_name_present",
      "conditions": {
        "all": [
          {
            "fact": "first_name",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "first_name",
          "code": "FIRST_NAME_MISSING",
          "message": "Имя обязательно",
          "ruleId": "first_name_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "first_name_format",
      "conditions": {
        "all": [
          {
            "fact": "first_name",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "first_name",
            "operator": "matchesRegex",
            "value": "^[а-яеА-Яе\\-]{1,100}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "first_name",
          "code": "FIRST_NAME_INVALID",
          "message": "Имя не должно содержать цифры или спецсимволы кроме дефиса, максимум 100 символов",
          "ruleId": "first_name_format",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "birth_date_present",
      "conditions": {
        "all": [
          {
            "fact": "birth_date",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "birth_date",
          "code": "BIRTH_DATE_MISSING",
          "message": "Дата рождения обязательна",
          "ruleId": "birth_date_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "birth_place_present",
      "conditions": {
        "all": [
          {
            "fact": "birth_place",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "birth_place",
          "code": "BIRTH_PLACE_MISSING",
          "message": "Место рождения обязательно",
          "ruleId": "birth_place_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "citizenship_present",
      "conditions": {
        "all": [
          {
            "fact": "citizenship",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "citizenship",
          "code": "CITIZENSHIP_MISSING",
          "message": "Гражданство обязательно",
          "ruleId": "citizenship_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "citizenship_valid",
      "conditions": {
        "all": [
          {
            "fact": "citizenship",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "citizenship",
            "operator": "notIn",
            "value": {
              "$ref": "dictionaries.citizenship.values_keys"
            }
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "citizenship",
          "code": "CITIZENSHIP_INVALID",
          "message": "Недопустимое значение гражданства",
          "ruleId": "citizenship_valid",
          "category": "DICT"
        }
      }
    },
    {
      "name": "passport_doc_type_code_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.doc_type_code",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.doc_type_code",
          "code": "DOC_TYPE_CODE_MISSING",
          "message": "Код вида документа обязателен",
          "ruleId": "passport_doc_type_code_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_doc_type_name_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.doc_type_name",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.doc_type_name",
          "code": "DOC_TYPE_NAME_MISSING",
          "message": "Наименование вида документа обязательно",
          "ruleId": "passport_doc_type_name_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_doc_type_code_allowed",
      "conditions": {
        "all": [
          {
            "fact": "passport.doc_type_code",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.doc_type_code",
            "operator": "notIn",
            "value": {
              "$ref": "dictionaries.doc_types.allowed_fl_resident"
            }
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.doc_type_code",
          "code": "DOC_TYPE_CODE_NOT_ALLOWED",
          "category": "DICT",
          "message": "Недопустимый вид документа для ФЛ-резидента",
          "ruleId": "passport_doc_type_code_allowed"
        }
      }
    },
    {
      "name": "passport_doc_type_name_matches_code",
      "conditions": {
        "all": [
          {
            "fact": "passport.doc_type_expected_name",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.doc_type_name",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.doc_type_name",
            "operator": "notEqual",
            "value": {
              "$fact": "passport.doc_type_expected_name"
            }
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.doc_type_name",
          "code": "DOC_TYPE_NAME_MISMATCH",
          "category": "DICT",
          "message": "Наименование вида документа не соответствует коду",
          "ruleId": "passport_doc_type_name_matches_code"
        }
      }
    },
    {
      "name": "passport_foreign_doc_flag_consistency",
      "conditions": {
        "all": [
          {
            "fact": "passport.isForeignIdDoc",
            "operator": "equal",
            "value": true
          },
          {
            "fact": "passport.foreign_doc",
            "operator": "equal",
            "value": "НЕТ"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.foreign_doc",
          "code": "FOREIGN_DOC_FLAG_INCONSISTENT",
          "category": "DICT",
          "message": "Признак 'документ иностранного гражданина/ЛБГ' не может быть 'НЕТ' для выбранного вида документа",
          "ruleId": "passport_foreign_doc_flag_consistency"
        }
      }
    },
    {
      "name": "passport_doc_type_code_blocked",
      "conditions": {
        "all": [
          {
            "fact": "passport.doc_type_code",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.doc_type_code",
            "operator": "equal",
            "value": 35
          }
        ]
      },
      "event": {
        "type": "COMPLIANCE_BLOCK",
        "params": {
          "field": "passport.doc_type_code",
          "code": "DOC_TYPE_CODE_BLOCKED",
          "ruleId": "passport_doc_type_code_blocked",
          "category": "REGULATORY"
        }
      }
    },
    {
      "name": "passport_series_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.series",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.series",
          "code": "PASSPORT_SERIES_MISSING",
          "message": "Серия паспорта обязательна",
          "ruleId": "passport_series_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_series_format",
      "conditions": {
        "all": [
          {
            "fact": "passport.series",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.series",
            "operator": "matchesRegex",
            "value": "^(?!0000)\\d{4}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.series",
          "code": "PASSPORT_SERIES_INVALID",
          "message": "Серия паспорта должна содержать ровно 4 цифры и не может быть 0000",
          "ruleId": "passport_series_format",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "passport_number_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.number",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.number",
          "code": "PASSPORT_NUMBER_MISSING",
          "message": "Номер паспорта обязателен",
          "ruleId": "passport_number_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_number_format",
      "conditions": {
        "all": [
          {
            "fact": "passport.number",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.number",
            "operator": "matchesRegex",
            "value": "^(?!000000)\\d{6}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.number",
          "code": "PASSPORT_NUMBER_INVALID",
          "message": "Номер паспорта должен содержать ровно 6 цифр и не может быть 000000",
          "ruleId": "passport_number_format",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "passport_division_code_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.division_code",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.division_code",
          "code": "DIVISION_CODE_MISSING",
          "message": "Код подразделения обязателен",
          "ruleId": "passport_division_code_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_division_code_format",
      "conditions": {
        "all": [
          {
            "fact": "passport.division_code",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.division_code",
            "operator": "matchesRegex",
            "value": "^(?!000-000)\\d{3}-\\d{3}$"
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.division_code",
          "code": "DIVISION_CODE_INVALID",
          "message": "Код подразделения должен соответствовать формату XXX-XXX и не может быть 000-000",
          "ruleId": "passport_division_code_format",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "passport_issue_date_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.issue_date",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.issue_date",
          "code": "ISSUE_DATE_MISSING",
          "message": "Дата выдачи паспорта обязательна",
          "ruleId": "passport_issue_date_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_issued_by_present",
      "conditions": {
        "all": [
          {
            "fact": "passport.issued_by",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "passport.issued_by",
          "code": "ISSUED_BY_MISSING",
          "message": "Наименование органа выдавшего документ обязательно",
          "ruleId": "passport_issued_by_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "passport_issued_by_garbage",
      "comment": "Мягкий контроль — предупреждение о мусорных символах",
      "conditions": {
        "all": [
          {
            "fact": "passport.issued_by",
            "operator": "fieldPresent",
            "value": true
          },
          {
            "fact": "passport.issued_by",
            "operator": "containsGarbageChars",
            "value": true
          }
        ]
      },
      "event": {
        "type": "VALIDATION_WARNING",
        "params": {
          "field": "passport.issued_by",
          "code": "ISSUED_BY_GARBAGE_CHARS",
          "message": "Наименование органа содержит недопустимые символы",
          "ruleId": "passport_issued_by_garbage",
          "category": "FORMAT"
        }
      }
    },
    {
      "name": "registration_address_present",
      "conditions": {
        "all": [
          {
            "fact": "registration_address.country_code",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "registration_address",
          "code": "REGISTRATION_ADDRESS_MISSING",
          "message": "Адрес регистрации обязателен",
          "ruleId": "registration_address_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "beneficiary_date_present",
      "conditions": {
        "all": [
          {
            "fact": "beneficiary_date",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "beneficiary_date",
          "code": "BENEFICIARY_DATE_MISSING",
          "message": "Дата приобретения статуса бенефициара обязательна",
          "ruleId": "beneficiary_date_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "beneficiary_id_present",
      "conditions": {
        "all": [
          {
            "fact": "beneficiary_id",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "beneficiary_id",
          "code": "BENEFICIARY_ID_MISSING",
          "message": "Идентификатор бенефициара обязателен",
          "ruleId": "beneficiary_id_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "contacts_email_present",
      "conditions": {
        "all": [
          {
            "fact": "contacts.email",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "contacts.email",
          "code": "CONTACT_EMAIL_MISSING",
          "message": "Email обязателен",
          "ruleId": "contacts_email_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "contacts_phone_ru_present",
      "conditions": {
        "all": [
          {
            "fact": "contacts.phone_ru",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "contacts.phone_ru",
          "code": "CONTACT_PHONE_RU_MISSING",
          "message": "Телефон РФ обязателен",
          "ruleId": "contacts_phone_ru_present",
          "category": "REQUIRED"
        }
      }
    },
    {
      "name": "contacts_postal_address_present",
      "conditions": {
        "all": [
          {
            "fact": "contacts.postal_address",
            "operator": "fieldPresent",
            "value": false
          }
        ]
      },
      "event": {
        "type": "VALIDATION_ERROR",
        "params": {
          "field": "contacts.postal_address",
          "code": "CONTACT_POSTAL_ADDRESS_MISSING",
          "message": "Почтовый адрес обязателен",
          "ruleId": "contacts_postal_address_present",
          "category": "REQUIRED"
        }
      }
    }
  ]
}
